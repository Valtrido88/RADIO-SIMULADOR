<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Radio MEDEVAC - Entrenamiento</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üöÅ Simulador de Radio MEDEVAC</h1>
            <p class="subtitle">Entrenamiento en Comunicaciones por Radio</p>
            <div id="backendStatus" class="status-pill">Backend: comprobando‚Ä¶</div>
        </header>

        <main class="radio-simulator">
            <!-- Panel de Control Principal -->
            <section class="control-panel">
                <div class="panel-header">
                    <h2>Transceptor UHF/VHF</h2>
                    <div class="power-indicator">
                        <span class="led" id="powerLed"></span>
                        <span id="powerStatus">Apagado</span>
                    </div>
                </div>

                <!-- Encendido/Apagado -->
                <div class="control-group">
                    <label for="powerToggle">Encendido</label>
                    <input type="checkbox" id="powerToggle" class="toggle-switch">
                </div>

                <!-- Selector de Banda -->
                <div class="control-group">
                    <label for="bandSelect">Banda:</label>
                    <select id="bandSelect">
                        <option value="uhf">UHF (300-400 MHz)</option>
                        <option value="vhf">VHF (118-137 MHz)</option>
                        <option value="mil">Militar (225-400 MHz)</option>
                    </select>
                </div>

                <!-- Frecuencia Principal -->
                <div class="frequency-display">
                    <div class="freq-label">FRECUENCIA</div>
                    <div class="freq-value" id="frequencyDisplay">121.500</div>
                    <div class="freq-unit">MHz</div>
                </div>

                <!-- Controles de Frecuencia -->
                <div class="frequency-controls">
                    <button id="freqDown" class="btn-freq">‚àí</button>
                    <input type="number" id="frequencyInput" min="100" max="400" step="0.025" value="121.500">
                    <button id="freqUp" class="btn-freq">+</button>
                </div>

                <!-- Canales Preestablecidos -->
                <div class="presets">
                    <label>Canales Preestablecidos:</label>
                    <div class="preset-buttons">
                        <button class="preset-btn" data-freq="121.500">Emergencia</button>
                        <button class="preset-btn" data-freq="118.100">Torre Control</button>
                        <button class="preset-btn" data-freq="243.000">SAR Militar</button>
                        <button class="preset-btn" data-freq="124.000">MEDEVAC</button>
                    </div>
                </div>

                <!-- Controles de Audio -->
                <div class="audio-controls">
                    <div class="control-group">
                        <label for="volumeSlider">Volumen</label>
                        <input type="range" id="volumeSlider" min="0" max="100" value="60">
                        <span id="volumeValue">60</span>
                    </div>
                    <div class="control-group">
                        <label for="squelchSlider">Squelch</label>
                        <input type="range" id="squelchSlider" min="0" max="10" value="3">
                        <span id="squelchValue">3</span>
                    </div>
                    <div class="control-group">
                        <label for="voiceSelect">Voz Operador</label>
                        <select id="voiceSelect">
                            <option value="male">Voz Masculina</option>
                            <option value="female">Voz Femenina</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="elevenLabsKey">API Key Eleven Labs (opcional - desarrollo)</label>
                        <input type="password" id="elevenLabsKey" placeholder="sk_... (opcional)" style="width: 100%; padding: 5px; font-size: 0.9em;">
                        <button id="saveApiKey" class="btn-small" style="margin-top: 5px;">Guardar API Key</button>
                        <span id="apiKeyStatus" style="font-size: 0.8em; margin-left: 5px;"></span>
                    </div>
                    <div class="control-group">
                        <label for="elevenCustomVoiceId">Voice ID Eleven Labs</label>
                        <input type="text" id="elevenCustomVoiceId" placeholder="(opcional) p.ej. 21m00Tcm4TlvDq8ikWAM" style="width: 100%; padding: 5px; font-size: 0.9em;">
                        <button id="saveVoiceId" class="btn-small" style="margin-top: 5px;">Guardar Voice ID</button>
                        <span id="voiceIdStatus" style="font-size: 0.8em; margin-left: 5px;"></span>
                    </div>
                    <div class="control-group">
                        <button id="testTTSButton" class="btn-small">Probar voz (backend)</button>
                    </div>
                </div>

                <!-- Medidor de Se√±al -->
                <div class="signal-meter">
                    <label>Intensidad de Se√±al</label>
                    <div class="meter-container">
                        <div class="meter-bar" id="signalMeter"></div>
                    </div>
                    <div class="meter-scale">
                        <span>0</span>
                        <span>S5</span>
                        <span>S9</span>
                    </div>
                </div>

                <!-- Indicadores de Estado -->
                <div class="status-indicators">
                    <div class="indicator">
                        <span class="led" id="rxLed"></span>
                        <span>RX (Recibiendo)</span>
                    </div>
                    <div class="indicator">
                        <span class="led" id="txLed"></span>
                        <span>TX (Transmitiendo)</span>
                    </div>
                    <div class="indicator">
                        <span class="led" id="squelchLed"></span>
                        <span>Squelch Activo</span>
                    </div>
                </div>
            </section>

            <!-- Panel de Transmisi√≥n -->
            <section class="transmission-panel">
                <div class="panel-header">
                    <h3>Protocolo de Transmisi√≥n</h3>
                </div>

                <div class="ptt-section">
                    <label for="messageInput">Mensaje:</label>
                    <textarea id="messageInput" placeholder="Ej: Base, Helic√≥ptero Uno con paciente cr√≠tico. Requerimos despeje en heliport. Cambio."></textarea>

                    <div class="message-guidelines">
                        <strong>üìã Protocolo MEDEVAC:</strong>
                        <ul>
                            <li>Saludar: Identif√≠cate primero</li>
                            <li>Mensaje: S√© claro y conciso</li>
                            <li>Finalizar: Siempre di "Cambio" o "Corto"</li>
                            <li>Confirmaci√≥n: Espera "Cambio" de retorno</li>
                        </ul>
                    </div>

                    <div class="ptt-button-container">
                        <button id="pttButton" class="ptt-button">
                            <span class="ptt-inner">PRESIONAR PARA TRANSMITIR</span>
                        </button>
                    </div>

                    <div class="transmission-info" id="transmissionInfo"></div>
                </div>
            </section>

            <!-- Panel de Historial -->
            <section class="history-panel">
                <div class="panel-header">
                    <h3>Historial de Comunicaciones</h3>
                    <button id="clearHistory" class="btn-small">Limpiar</button>
                </div>

                <div class="history-container" id="historyContainer">
                    <div class="history-placeholder">El historial aparecer√° aqu√≠...</div>
                </div>
            </section>
        </main>

        <!-- Panel de Ayuda Operacional -->
        <section class="ops-panel">
            <div class="panel-header">
                <h3>Ayuda Operacional</h3>
            </div>
            <div class="ops-content">
                <div class="ops-columns">
                    <!-- 9 L√≠neas MEDEVAC -->
                    <div class="nine-line">
                        <h4>Formato MEDEVAC - 9 L√≠neas</h4>
                        <ol>
                            <li><strong>L√≠nea 1:</strong> Ubicaci√≥n del punto de recogida</li>
                            <li><strong>L√≠nea 2:</strong> Frecuencia / Indicativo</li>
                            <li><strong>L√≠nea 3:</strong> N√∫mero de pacientes por precedencia (Urgente/Prioridad/Rutina)</li>
                            <li><strong>L√≠nea 4:</strong> Equipo especial requerido (Ninguno/Guinche/Ventilador)</li>
                            <li><strong>L√≠nea 5:</strong> N√∫mero de pacientes por tipo (Camilla/Ambulatorio)</li>
                            <li><strong>L√≠nea 6:</strong> Seguridad del punto (Sin enemigo/Posible/Confirmado)</li>
                            <li><strong>L√≠nea 7:</strong> Se√±alizaci√≥n del punto (Humo/P√°neles/IR/Bengala)</li>
                            <li><strong>L√≠nea 8:</strong> Nacionalidad/Estado del paciente</li>
                            <li><strong>L√≠nea 9:</strong> Contaminaci√≥n NBC (Ninguna/Q/B/R)</li>
                        </ol>
                        <div class="nine-line-actions">
                            <button id="copyNineLineTemplate" class="btn-small">Copiar plantilla 9 l√≠neas</button>
                        </div>
                    </div>

                    <!-- Alfabeto Fon√©tico OTAN -->
                    <div class="phonetic">
                        <h4>Alfabeto Fon√©tico OTAN</h4>
                        <div class="phonetic-grid">
                            <span>A - Alfa</span><span>B - Bravo</span><span>C - Charlie</span><span>D - Delta</span>
                            <span>E - Echo</span><span>F - Foxtrot</span><span>G - Golf</span><span>H - Hotel</span>
                            <span>I - India</span><span>J - Juliett</span><span>K - Kilo</span><span>L - Lima</span>
                            <span>M - Mike</span><span>N - November</span><span>O - Oscar</span><span>P - Papa</span>
                            <span>Q - Quebec</span><span>R - Romeo</span><span>S - Sierra</span><span>T - Tango</span>
                            <span>U - Uniform</span><span>V - Victor</span><span>W - Whiskey</span><span>X - X-ray</span>
                            <span>Y - Yankee</span><span>Z - Zulu</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Panel de Escenarios MEDEVAC -->
        <section class="scenario-panel">
            <div class="panel-header">
                <h3>Escenarios MEDEVAC</h3>
                <div>
                    <button id="generateScenario" class="btn-small">Generar caso</button>
                    <button id="copyNineLine" class="btn-small">Copiar 9 l√≠neas</button>
                    <button id="loadNineLineToMsg" class="btn-small">Cargar 9 l√≠neas</button>
                    <button id="loadProceduralToMsg" class="btn-small">Cargar mensaje radio</button>
                </div>
            </div>
            <div class="role-selectors">
                <div class="control-group">
                    <label for="emitterRole">Emisor</label>
                    <select id="emitterRole">
                        <option value="Helo Uno">Helo Uno</option>
                        <option value="MEDEVAC Uno">MEDEVAC Uno</option>
                        <option value="Charlie 1">Charlie 1</option>
                        <option value="Charlie 2">Charlie 2</option>
                        <option value="Role 1">Role 1 (Puesto Avanzado)</option>
                        <option value="Role 2">Role 2</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="receiverRole">Receptor</label>
                    <select id="receiverRole">
                        <option value="Base">Base (Puesto de Control)</option>
                        <option value="Role 1">Hospital Role 1</option>
                        <option value="Role 2">Hospital Role 2</option>
                        <option value="Role 3">Hospital Role 3</option>
                        <option value="Torre">Torre de Control</option>
                    </select>
                </div>
                <div class="control-group" style="grid-column: 1 / -1;">
                    <label for="backendBase">Backend URL</label>
                    <input type="text" id="backendBase" placeholder="(opcional) https://tu-worker.workers.dev" style="flex:1; padding: 6px; background: var(--secondary-color); color: var(--text-light); border: 1px solid var(--border-color); border-radius: 4px;">
                </div>
            </div>
            <div class="role-selectors" style="margin-top:10px; border-top: 1px dashed #ddd; padding-top: 10px;">
                <div class="control-group">
                    <label for="useGemini">IA (Gemini)</label>
                    <div>
                        <input type="checkbox" id="useGemini"> <span>Usar Google Gemini para generar casos</span>
                    </div>
                </div>
                <div class="control-group">
                    <label for="geminiDifficulty">Dificultad</label>
                    <select id="geminiDifficulty">
                        <option value="aleatorio">Aleatorio</option>
                        <option value="facil">F√°cil</option>
                        <option value="intermedio" selected>Intermedio</option>
                        <option value="dificil">Dif√≠cil</option>
                    </select>
                </div>
                <div class="control-group" style="flex:2 1 auto; min-width:240px;">
                    <label for="geminiApiKey">API Key Gemini</label>
                    <input type="password" id="geminiApiKey" placeholder="AIza..." style="width: 100%; padding: 5px; font-size: 0.9em;">
                    <div style="display:flex; align-items:center; gap:8px; margin-top:5px;">
                        <button id="saveGeminiKey" class="btn-small">Guardar API Key</button>
                        <span id="geminiKeyStatus" style="font-size:0.8em;"></span>
                    </div>
                </div>
            </div>
            <div id="scenarioContainer" class="scenario-container">
                <div class="history-placeholder">Genera un caso para entrenar evacuaci√≥n m√©dica.</div>
            </div>
        </section>

        <!-- Panel de Ayuda -->
        <footer class="help-panel">
            <details>
                <summary>‚ùì Ayuda y Tutorial</summary>
                <div class="help-content">
                    <h4>C√≥mo usar el Simulador:</h4>
                    <ol>
                        <li><strong>Enciende la radio:</strong> Marca el checkbox "Encendido"</li>
                        <li><strong>Selecciona banda:</strong> Elige UHF, VHF o Militar</li>
                        <li><strong>Ajusta frecuencia:</strong> Usa los botones ¬± o escribe directamente</li>
                        <li><strong>Prueba presets:</strong> Haz clic en "Emergencia", "Tr√°fico", etc.</li>
                        <li><strong>Transmite:</strong> Escribe tu mensaje y presiona el bot√≥n PTT (o mant√©n clic)</li>
                        <li><strong>Observa historial:</strong> Todas tus transmisiones se registran</li>
                    </ol>

                    <h4>Protocolos Reales MEDEVAC:</h4>
                    
                    <p><strong>üîä Radio Check (Prueba de Sonido):</strong></p>
                    <p style="margin-left: 20px;">"Base, aqu√≠ Helic√≥ptero Uno. Radio check. Cambio."</p>
                    <p style="margin-left: 20px; color: #4CAF50;">‚Üí "Te copiamos Lima Charlie. 5 por 5. Cambio."</p>
                    
                    <p><strong>üö® Emergencia / Paciente Cr√≠tico:</strong></p>
                    <p style="margin-left: 20px;">"Base, Helic√≥ptero Uno con paciente cr√≠tico a bordo. Solicitamos despeje prioritario. Cambio."</p>
                    <p style="margin-left: 20px; color: #4CAF50;">‚Üí "Roger emergencia. Hospital notificado. Trauma preparado. Cambio."</p>
                    
                    <p><strong>‚úàÔ∏è Solicitud de Aterrizaje:</strong></p>
                    <p style="margin-left: 20px;">"Base, Helic√≥ptero Uno solicitando autorizaci√≥n de aterrizaje en heliport. Cambio."</p>
                    <p style="margin-left: 20px; color: #4CAF50;">‚Üí "Autorizado aterrizaje. Zona despejada. Viento norte 5 nudos. Cambio."</p>
                    
                    <p><strong>üìç Reporte de Posici√≥n:</strong></p>
                    <p style="margin-left: 20px;">"Base, Helic√≥ptero Uno. Posici√≥n: 10 millas al norte. ETA 5 minutos. Cambio."</p>
                    <p style="margin-left: 20px; color: #4CAF50;">‚Üí "Roger tu posici√≥n. Heliport ser√° despejado. Cambio."</p>
                    
                    <p><strong>Terminolog√≠a Militar:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li><strong>Lima Charlie</strong> = Loud & Clear (fuerte y claro)</li>
                        <li><strong>5 por 5</strong> = Se√±al perfecta</li>
                        <li><strong>Roger</strong> = Recibido/Entendido</li>
                        <li><strong>Wilco</strong> = Will Comply (voy a cumplir)</li>
                        <li><strong>Cambio</strong> = Termino, espero respuesta</li>
                        <li><strong>Corto</strong> = Termino comunicaci√≥n</li>
                        <li><strong>ETA</strong> = Estimated Time of Arrival</li>
                    </ul>
                    
                    <p><strong>Frecuencias Importantes:</strong></p>
                    <p style="margin-left: 20px;">121.500 MHz = Emergencia internacional</p>
                    <p style="margin-left: 20px;">243.000 MHz = SAR Militar (Search and Rescue)</p>

                    <h4>Bandas de Frecuencia:</h4>
                    <ul>
                        <li><strong>UHF:</strong> Alcance corto-medio, bueno para corta distancia</li>
                        <li><strong>VHF:</strong> Aviaci√≥n, alcance medio-largo, frecuencia 121.5 es emergencia</li>
                        <li><strong>Militar:</strong> Rango extendido, uso espec√≠fico</li>
                    </ul>

                    <h4>Indicadores:</h4>
                    <ul>
                        <li><strong>LED Verde:</strong> Funci√≥n activa o en espera</li>
                        <li><strong>LED Rojo:</strong> Transmitiendo</li>
                        <li><strong>LED Naranja:</strong> Recibiendo o alerta</li>
                    </ul>
                </div>
            </details>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>
